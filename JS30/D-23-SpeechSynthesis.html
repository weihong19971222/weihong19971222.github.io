<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D-23-SpeechSynthesis</title>
    <link rel="stylesheet" href="./css/d-23/d-23.css">
</head>

<body>
    <main>
        <div class="voiceinator">
            <h1>Ë™ûÈü≥Êí≠Â†±Âì°</h1>
            <select name="voice" id="voices">
                <option value="">Select A Voice</option>
            </select>
            <label for="rate">Rate:</label>
            <input name="rate" type="range" min="0" max="3" value="1" step="0.1">
            <label for="pitch">Pitch:</label>
            <input name="pitch" type="range" min="0" max="2" step="0.1">
            <textarea name="text">Hello! I love JavaScript üëç</textarea>
            <div id="bts">
                <button id="stop">Stop!</button>
                <button id="speak">Speak</button>
            </div>
        </div>
    </main>

    <script>
        // ÂâµÁ´ãSpeechSynthesisUtteranceÁâ©‰ª∂
        const msg = new SpeechSynthesisUtterance();

        let voices = [];
        const voicesDropdown = document.querySelector('[name="voice"]');

        const options = document.querySelectorAll('[type="range"], [name="text"]');
        const speakButton = document.querySelector('#speak');
        const stopButton = document.querySelector('#stop');

        msg.volume=0.2;
        //Ë®≠ÂÆötextÁÇ∫Ë™™Ë©±ÁØÑÊú¨
        msg.text = document.querySelector('[name="text"]').value;
        
        // Êì∑ÂèñË™ûÈü≥Ê®°ÁµÑÊ∏ÖÂñÆ
        function populateVoices() {
            // speechSynthesis.getVoices() ÊñπÊ≥ïÊúÉÂõûÂÇ≥ SpeechSynthesisVoiceList
            voices = this.getVoices();
            voicesDropdown.innerHTML = voices
                // .filter(voice => voice.lang.includes('en')) //Âä†ÈÄô‰∏≤ÁÇ∫ÁØ©ÈÅ∏Ë™ûÁ≥ª
                .map(voice => `<option value="${voice.name}">${voice.name} (${voice.lang})</option>`)
                .join('');
        }

        function setVoice() {
            // voice Â±¨ÊÄßÂèØ‰ª•Ë®≠ÂÆöË¶Å‰ΩøÁî®Âì™ÂÄãË™ûÈü≥Ê®°ÁµÑ
            msg.voice = voices.find(voice => voice.name == this.value);
            // Ë®≠ÂÆöÂÆåÂ∞±Êí≠Êîæ
            toggle();
        }

        //‰ΩúÁÇ∫ÈñãÈóú, È†êË®≠Â∏∂ÂÖ•ÁÇ∫true
        function toggle(startOver = true) {
            // ÂÖàÂÅúÊ≠¢
            speechSynthesis.cancel();
            // Â¶ÇÊûú startOver ÈñãÈóúÊòØÊâìÈñãÁöÑÊâçÊúÉÊí≠Êîæ
            if (startOver) {
                // ËÆÄÂá∫Ë™ûÈü≥ÈúÄÊ±Ç
                speechSynthesis.speak(msg);
            }
        }

        // SpeechSynthesisUtterance ÁöÑ pitch Â±¨ÊÄßÂèØ‰ª•Ë®≠ÂÆöË™ûÈü≥Èü≥Ë™ø„ÄÅrate Â±¨ÊÄßÂèØ‰ª•Ë®≠ÂÆöË™ûÈü≥ÈÄüÂ∫¶
        function setOption() {
            msg[this.name] = this.value;
            // Ë®≠ÂÆöÂÆåÂ∞±Êí≠Êîæ
            toggle();
        }

        // voicechanged ‰∫ã‰ª∂ÂâáÊòØÂú® SpeechSynthesisVoiceList ÂÖßÂÆπÊîπËÆäÊôÇÊúÉË¢´Ëß∏Áôº
        // SpeechSynthesisVoiceList ÊòØÁÄèË¶ΩÂô®ÊîØÊè¥ÁöÑË™ûÈü≥ÊâÄÁµÑÊàêÁöÑÊ∏ÖÂñÆÔºåË©≤Ê∏ÖÂñÆÊúÉÂú®ÁÄèË¶ΩÂô®È†ÅÈù¢ÈñãÂïüÊôÇË¢´ÂÆâË£ù
        // voicechanged Âú®ÁÄèË¶ΩÂô®ÈñãÂïüÂæåÔºå SpeechSynthesisVoiceList ÂÆâË£ùÂÆåÁï¢ÊôÇÂ∞±ÊúÉË¢´Ëß∏Áôº‰∏ÄÊ¨°
        speechSynthesis.addEventListener('voiceschanged', populateVoices);

        voicesDropdown.addEventListener('change', setVoice);
        options.forEach(option => option.addEventListener('change', setOption));
        speakButton.addEventListener('click', toggle);
        stopButton.addEventListener('click', () => toggle(false));
    </script>
</body>

</html>